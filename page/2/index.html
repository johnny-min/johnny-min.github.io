<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  

  
  <title>Hexo</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta property="og:type" content="website">
<meta property="og:title" content="Hexo">
<meta property="og:url" content="http://yoursite.com/page/2/index.html">
<meta property="og:site_name" content="Hexo">
<meta property="og:locale" content="en_US">
<meta property="article:author" content="John Doe">
<meta name="twitter:card" content="summary">
  
    <link rel="alternate" href="/atom.xml" title="Hexo" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  
<link rel="stylesheet" href="/css/style.css">

<meta name="generator" content="Hexo 4.2.1"></head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">Hexo</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://yoursite.com"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main">
  
    <article id="post-并发和并行" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2020/08/14/%E5%B9%B6%E5%8F%91%E5%92%8C%E5%B9%B6%E8%A1%8C/" class="article-date">
  <time datetime="2020-08-14T03:09:23.000Z" itemprop="datePublished">2020-08-14</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2020/08/14/%E5%B9%B6%E5%8F%91%E5%92%8C%E5%B9%B6%E8%A1%8C/">并发和并行</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>并发的关键是你有处理多个任务的能力，不一定要同时。<br>并行的关键是你有同时处理多个任务的能力。</p>
<p>所以它们最关键的点就是：是否是 同时。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2020/08/14/%E5%B9%B6%E5%8F%91%E5%92%8C%E5%B9%B6%E8%A1%8C/" data-id="ckdtu680p0000goujcii3besa" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E5%B9%B6%E5%8F%91/" rel="tag">并发</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E5%B9%B6%E8%A1%8C/" rel="tag">并行</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-mysql索引" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2020/08/14/mysql%E7%B4%A2%E5%BC%95/" class="article-date">
  <time datetime="2020-08-14T02:17:32.000Z" itemprop="datePublished">2020-08-14</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2020/08/14/mysql%E7%B4%A2%E5%BC%95/">mysql索引</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="索引定义"><a href="#索引定义" class="headerlink" title="索引定义"></a>索引定义</h2><p>mysql索引的官方定义是帮助mysql高效获取数据的数据结构，索引可以大大提高MySQL的检索速度。</p>
<h2 id="索引文件"><a href="#索引文件" class="headerlink" title="索引文件"></a>索引文件</h2><p>定义了索引后，会生成索引文件，它保存了数据操作的地址。<br>MyISAM引擎:<br>.myd 即 my data, 表数据文件<br>.myi 即 my index, 索引文件<br>InnoDB引擎：（采用表空间来管理数据，存储表数据和索引）<br>InnoDB数据库文件： ibdata1、ibdata2等：系统表空间文件，存储InnoDB系统信息和用户数据库表数据和索引，所有表共用。<br>.ibd文件：单表表空间文件，每个表使用一个表空间文件（file per table），存放用户数据库表数据和索引。<br>日志文件：ib_logfile1、ib_logfile2</p>
<h2 id="理解"><a href="#理解" class="headerlink" title="理解"></a>理解</h2><p>打个比方：在一个班级里，老师要找小明，如果一个一个找会很慢，怎么办呢？老师可以通过找小明所在的列。<br>老师记住每名学生的位置占用了其大脑的空间，这样每来一名新同学老师都要记住位置，或者离开一名同学就要删除该同学的位置。所以索引会影响数据的更新速度。</p>
<h2 id="锁"><a href="#锁" class="headerlink" title="锁"></a>锁</h2><p>select * from game_two_player for update; # 互斥锁、排他锁<br>select * from game_two_player LOCK IN SHARE MODE; # 共享锁 可以一起读取，但不能修改</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2020/08/14/mysql%E7%B4%A2%E5%BC%95/" data-id="ckdtu68170001gouj8ijvfzr9" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/mysql/" rel="tag">mysql</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-解决go依赖包被墙" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2020/08/12/%E8%A7%A3%E5%86%B3go%E4%BE%9D%E8%B5%96%E5%8C%85%E8%A2%AB%E5%A2%99/" class="article-date">
  <time datetime="2020-08-12T05:13:39.000Z" itemprop="datePublished">2020-08-12</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2020/08/12/%E8%A7%A3%E5%86%B3go%E4%BE%9D%E8%B5%96%E5%8C%85%E8%A2%AB%E5%A2%99/">解决go依赖包被墙</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="最省事的方法设置GO111MODULE和GOPROXY"><a href="#最省事的方法设置GO111MODULE和GOPROXY" class="headerlink" title="最省事的方法设置GO111MODULE和GOPROXY"></a>最省事的方法设置GO111MODULE和GOPROXY</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">go env -w GO111MODULE&#x3D;on</span><br><span class="line">go env -w GOPROXY&#x3D;https:&#x2F;&#x2F;goproxy.cn,direct</span><br></pre></td></tr></table></figure>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2020/08/12/%E8%A7%A3%E5%86%B3go%E4%BE%9D%E8%B5%96%E5%8C%85%E8%A2%AB%E5%A2%99/" data-id="ckdr4gya00002bcuj54prf3vw" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/go/" rel="tag">go</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-后端耗时任务" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2020/08/07/%E5%90%8E%E7%AB%AF%E8%80%97%E6%97%B6%E4%BB%BB%E5%8A%A1/" class="article-date">
  <time datetime="2020-08-07T01:35:27.000Z" itemprop="datePublished">2020-08-07</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2020/08/07/%E5%90%8E%E7%AB%AF%E8%80%97%E6%97%B6%E4%BB%BB%E5%8A%A1/">后端耗时操作</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="引入"><a href="#引入" class="headerlink" title="引入"></a>引入</h2><p>在前后端交互中，如果后端进行了很耗时的操作，前端迟迟收不到响应就会报错。</p>
<h2 id="处理"><a href="#处理" class="headerlink" title="处理"></a>处理</h2><p>目前我想到了两种方法：<br>1.提前处理， 2.异步处理。</p>
<h2 id="提前处理"><a href="#提前处理" class="headerlink" title="提前处理"></a>提前处理</h2><p>适用于数据变化频率不高的场景。比如一天一变，可以在前一天晚上处理好数据，然后再查询处理好的数据。这样响应速度就会大大提高。</p>
<h2 id="异步处理"><a href="#异步处理" class="headerlink" title="异步处理"></a>异步处理</h2><p>直接返回并将耗时任务放到后台。这里可以使用celery以及concurrent.futures。大型项目的话使用celery会好一点。<br>下面是concurrent.futures的简单使用</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line">from flask import jsonify, app</span><br><span class="line">from concurrent.futures import ThreadPoolExecutor,  ProcessPoolExecutor</span><br><span class="line"></span><br><span class="line">app &#x3D; Flask(__name__)</span><br><span class="line">executor &#x3D; ThreadPoolExecutor(3)  # 线程池大小</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def func_task():</span><br><span class="line">    print(&#39;start&#39;)</span><br><span class="line">    time.sleep(10)</span><br><span class="line">    print(&#39;end&#39;)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">@app.route(&#39;&#x2F;task&#x2F;&#39;)</span><br><span class="line">def send_mail():</span><br><span class="line">    executor.submit(func_task)</span><br><span class="line">    return jsonify(&#123;&#39;code&#39;: 200, &#39;msg&#39;: &#39;success&#39;&#125;)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">task_list &#x3D; [&#39;a&#39;, &#39;b&#39;, &#39;c&#39;]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def map_task(item):</span><br><span class="line">    time.sleep(10)</span><br><span class="line">    print(item)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">@app.route(&#39;&#x2F;task_map&#x2F;&#39;)</span><br><span class="line">def task_map():</span><br><span class="line">    executor.map(map_task, task_list)   # map 操作线程池</span><br><span class="line">    return jsonify(&#123;&#39;code&#39;: 200, &#39;msg&#39;: &#39;success&#39;&#125;)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">@app.route(&#39;&#x2F;task_wait&#x2F;&#39;)</span><br><span class="line">def task_wait():</span><br><span class="line">    f_list &#x3D; []</span><br><span class="line">    for _ in task_list:</span><br><span class="line">        future &#x3D; executor.submit(map_task, _)</span><br><span class="line">        f_list.append(future)</span><br><span class="line">    return jsonify(&#123;&#39;code&#39;: 200, &#39;data&#39;: wait(f_list)&#125;)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">if __name__ &#x3D;&#x3D; &#39;__main__&#39;:</span><br><span class="line">    app.run(&#39;0.0.0.0&#39;)</span><br></pre></td></tr></table></figure>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2020/08/07/%E5%90%8E%E7%AB%AF%E8%80%97%E6%97%B6%E4%BB%BB%E5%8A%A1/" data-id="ckdr4gya10003bcujegqy978h" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/concurrent-future/" rel="tag">concurrent.future</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/flask/" rel="tag">flask</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/python/" rel="tag">python</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-mysql-bin文件" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2020/08/06/mysql-bin%E6%96%87%E4%BB%B6/" class="article-date">
  <time datetime="2020-08-06T03:21:53.000Z" itemprop="datePublished">2020-08-06</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2020/08/06/mysql-bin%E6%96%87%E4%BB%B6/">mysql-bin文件</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="mysql-log文件里的mysql-bin文件"><a href="#mysql-log文件里的mysql-bin文件" class="headerlink" title="mysql log文件里的mysql-bin文件"></a>mysql log文件里的mysql-bin文件</h2><p>mysql-bin是mysql用来构建复制时候用的文件，如果不做’主从复制’的话，可以删除掉它，但是使用rm删除会不安全，若以可以通过mysql的命令去删除。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mysql -u root -p</span><br><span class="line">reset master;</span><br></pre></td></tr></table></figure>
<p>或者更改配置文件,加入如下几句话，设定日志文件保留的天数。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">log-bin&#x3D;mysql-bin</span><br><span class="line">expire_logs_days &#x3D; 7</span><br></pre></td></tr></table></figure>
<h2 id="引入概念主从复制"><a href="#引入概念主从复制" class="headerlink" title="引入概念主从复制"></a>引入概念主从复制</h2><p>mysql 为什么要做主从复制（读写分离）？主要是为了性能考虑</p>
<h3 id="区分集群"><a href="#区分集群" class="headerlink" title="区分集群"></a>区分集群</h3><p>集群是由多台数据库服务器组成，数据写入和查询是在随机的一台机子进行的，其他数据库服务器会自动同步数据库操作。</p>
<h2 id="主从复制"><a href="#主从复制" class="headerlink" title="主从复制"></a>主从复制</h2><p>主从复制有两种方式：基于日志（binlog）；基于GTID（全局事务标示符）。</p>
<h2 id="总表分表构建"><a href="#总表分表构建" class="headerlink" title="总表分表构建"></a>总表分表构建</h2><p>总表查询，分表写入（总表和分表结构必须保持一致）<br>分表结构：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">CREATE TABLE &#96;b&#96; (</span><br><span class="line">  &#96;sys_id&#96; int(11) NOT NULL AUTO_INCREMENT,</span><br><span class="line">  &#96;sys_time&#96; datetime DEFAULT NULL,</span><br><span class="line">  KEY &#96;roomid&#96; (&#96;roomId&#96;) USING HASH,</span><br><span class="line">  KEY &#96;sys_time&#96; (&#96;sys_time&#96;) USING HASH</span><br><span class="line">) ENGINE&#x3D;MyISAM AUTO_INCREMENT&#x3D;8149668 DEFAULT CHARSET&#x3D;utf8mb4;</span><br></pre></td></tr></table></figure>
<p>总表：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">CREATE TABLE &#96;a&#96; (</span><br><span class="line">  &#96;sys_id&#96; int(11) NOT NULL AUTO_INCREMENT,</span><br><span class="line">  &#96;sys_time&#96; datetime DEFAULT NULL,</span><br><span class="line">  PRIMARY KEY (&#96;sys_id&#96;),</span><br><span class="line">  KEY &#96;sys_time&#96; (&#96;sys_time&#96;) USING HASH</span><br><span class="line">) ENGINE&#x3D;MRG_MyISAM DEFAULT CHARSET&#x3D;utf8mb4 UNION&#x3D;(&#96;b&#96;,&#96;c&#96;,&#96;d&#96;);</span><br></pre></td></tr></table></figure>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2020/08/06/mysql-bin%E6%96%87%E4%BB%B6/" data-id="ckdr4gy8l0000bcujgadpdlef" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/mysql/" rel="tag">mysql</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-flask-nginx-uwgi-supervisor部署" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2020/07/30/flask-nginx-uwgi-supervisor%E9%83%A8%E7%BD%B2/" class="article-date">
  <time datetime="2020-07-30T01:30:21.000Z" itemprop="datePublished">2020-07-30</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2020/07/30/flask-nginx-uwgi-supervisor%E9%83%A8%E7%BD%B2/">flask+nginx+uwgi+supervisor部署</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="1-安装python"><a href="#1-安装python" class="headerlink" title="1.安装python"></a>1.安装python</h2><p>安装wget</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum -y install wget</span><br></pre></td></tr></table></figure>
<p>下载python包</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wget https:&#x2F;&#x2F;www.python.org&#x2F;ftp&#x2F;python&#x2F;3.8.2&#x2F;Python-3.8.2.tgz</span><br></pre></td></tr></table></figure>
<p>解压python到project目录下</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tar zxvf Python-3.8.2.tgz -C &#x2F;project&#x2F;</span><br></pre></td></tr></table></figure>
<p>编译时出错zipimport.ZipImportError: can’t decompress data; zlib not available</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">yum install zlib* -y    # 缺少zlib包，安装zlib包</span><br><span class="line">make &amp;&amp; make install</span><br></pre></td></tr></table></figure>
<p>编译</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">.&#x2F;configure --prefix&#x3D;&#x2F;root&#x2F;Python3.8.2</span><br><span class="line">make &amp;&amp; make install</span><br></pre></td></tr></table></figure>
<p>创建软链接</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ln -s &#x2F;project&#x2F;Python-3.8.2&#x2F;bin&#x2F;python3.8 &#x2F;usr&#x2F;bin&#x2F;python3</span><br><span class="line">ln -s &#x2F;project&#x2F;Python-3.8.2&#x2F;bin&#x2F;pip3.8 &#x2F;usr&#x2F;bin&#x2F;pip3</span><br></pre></td></tr></table></figure>
<h2 id="centos安装mysql"><a href="#centos安装mysql" class="headerlink" title="centos安装mysql"></a>centos安装mysql</h2><p>1.下载mysql包</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wget https:&#x2F;&#x2F;dev.mysql.com&#x2F;get&#x2F;Downloads&#x2F;MySQL-5.7&#x2F;mysql-5.7.25-linux-glibc2.12-x86_64.tar.gz</span><br></pre></td></tr></table></figure>
<p>2.解压包到/usr/local/</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tar -zxvf mysql-5.7.25-linux-glibc2.12-x86_64.tar.gz -C &#x2F;usr&#x2F;local&#x2F;</span><br></pre></td></tr></table></figure>
<p>3.改文件名</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cd &#x2F;usr&#x2F;local&#x2F;</span><br><span class="line">mv mysql-5.7.25-linux-glibc2.12-x86_64  mysql</span><br></pre></td></tr></table></figure>
<p>4.添加mysql用户</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">cd mysql&#x2F;</span><br><span class="line">useradd -s &#x2F;bin&#x2F;false -M mysql</span><br><span class="line">cd ..</span><br><span class="line">chown -R mysql:mysql mysql</span><br></pre></td></tr></table></figure>
<p>5.创建cnf文件，mysql-bin.log文件,mysql-error.log文件</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">touch &#x2F;etc&#x2F;my.cnf</span><br><span class="line">mkdir &#x2F;usr&#x2F;local&#x2F;mysql&#x2F;logs</span><br><span class="line">touch &#x2F;usr&#x2F;local&#x2F;mysql&#x2F;logs&#x2F;mysql-bin.log</span><br><span class="line">touch &#x2F;usr&#x2F;local&#x2F;mysql&#x2F;mysql-error.log</span><br></pre></td></tr></table></figure>
<p>6.修改mysql目录权限</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cd &#x2F;usr&#x2F;local&#x2F;</span><br><span class="line">chown -R mysql:mysql mysql</span><br></pre></td></tr></table></figure>
<p>7.初始化数据库,并记录最后的数据库密码</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cd &#x2F;usr&#x2F;local&#x2F;mysql&#x2F;bin</span><br><span class="line"> .&#x2F;mysqld --initialize --user&#x3D;mysql --basedir&#x3D;&#x2F;usr&#x2F;local&#x2F;mysql --datadir&#x3D;&#x2F;usr&#x2F;local&#x2F;mysql&#x2F;data</span><br></pre></td></tr></table></figure>
<p>将 mysql 加入服务</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cp &#x2F;usr&#x2F;local&#x2F;mysql&#x2F;support-files&#x2F;mysql.server  &#x2F;etc&#x2F;init.d&#x2F;mysql</span><br></pre></td></tr></table></figure>
<p>8.配置mysql，/etc/my.cnf</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">[mysqld]</span><br><span class="line"># binlog 配置</span><br><span class="line">log-bin&#x3D;&#x2F;usr&#x2F;local&#x2F;mysql&#x2F;logs&#x2F;mysql-bin.log</span><br><span class="line">expire-logs-days&#x3D;14</span><br><span class="line">max-binlog-size&#x3D;500M</span><br><span class="line">server-id&#x3D;1</span><br><span class="line"># GENERAL</span><br><span class="line">basedir&#x3D;&#x2F;usr&#x2F;local&#x2F;mysql</span><br><span class="line">datadir&#x3D;&#x2F;usr&#x2F;local&#x2F;mysql&#x2F;data</span><br><span class="line">socket&#x3D;&#x2F;usr&#x2F;local&#x2F;mysql&#x2F;mysql.sock</span><br><span class="line">user&#x3D;mysql</span><br><span class="line">default-storage-engine&#x3D;InnoDB</span><br><span class="line">character-set-server&#x3D;utf8</span><br><span class="line">lower_case_table_names &#x3D; 0  # 为0时，数据库名可以大写</span><br><span class="line">explicit_defaults_for_timestamp&#x3D;true</span><br><span class="line">[mysqld_safe]</span><br><span class="line">log-error&#x3D;&#x2F;usr&#x2F;local&#x2F;mysql&#x2F;mysql-error.log</span><br><span class="line">pid-file&#x3D;&#x2F;usr&#x2F;local&#x2F;mysql&#x2F;mysqld.pid</span><br><span class="line">[client]</span><br><span class="line">socket&#x3D;&#x2F;usr&#x2F;local&#x2F;mysql&#x2F;mysql.sock</span><br><span class="line">[mysql]</span><br><span class="line">default-character-set&#x3D;utf8</span><br><span class="line">socket&#x3D;&#x2F;usr&#x2F;local&#x2F;mysql&#x2F;mysql.sock</span><br></pre></td></tr></table></figure>
<p>9.开启mysql</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">service mysqld start</span><br><span class="line">service mysqld stop</span><br></pre></td></tr></table></figure>
<p>10.进入mysql</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cd &#x2F;usr&#x2F;local&#x2F;mysql&#x2F;bin</span><br><span class="line"> .&#x2F;mysql -u root -p</span><br></pre></td></tr></table></figure>
<p>修改密码：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">use mysql;</span><br><span class="line">ALTER USER &#39;root&#39;@&#39;localhost&#39; IDENTIFIED BY &#39;123456&#39;;</span><br><span class="line">CREATE USER &#39;root&#39;@&#39;%&#39; IDENTIFIED BY &#39;123456&#39;;</span><br><span class="line">GRANT ALL PRIVILEGES ON  *.* TO &#39;root&#39;@&#39;%&#39; IDENTIFIED BY &#39;123456&#39;;</span><br><span class="line">GRANT ALL PRIVILEGES ON *.* TO &#39;root&#39;@&#39;%&#39; IDENTIFIED BY &#39;123456&#39; WITH GRANT OPTION;</span><br><span class="line">flush privileges;</span><br></pre></td></tr></table></figure>
<h2 id="安装nginx"><a href="#安装nginx" class="headerlink" title="安装nginx"></a>安装nginx</h2><p>nginx是高性能的http和反向代理的web服务器，仅仅支持静态网页，对于支持动态网页就会显得无能为力，在处理并发上较强。<br>1.安装依赖</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">yum install gcc-c++</span><br><span class="line">yum install -y pcre pcre-devel</span><br><span class="line">yum install -y zlib zlib-devel</span><br><span class="line">yum install -y openssl openssl-devel</span><br></pre></td></tr></table></figure>
<p>2.下载包</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wget https:&#x2F;&#x2F;nginx.org&#x2F;download&#x2F;nginx-1.18.0.tar.gz</span><br></pre></td></tr></table></figure>
<p>3.解压</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">tar -zxvf nginx-1.18.0.tar.gz</span><br><span class="line">cd nginx-1.18.0</span><br></pre></td></tr></table></figure>
<p>4.配置</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">.&#x2F;configure   # 默认配置</span><br></pre></td></tr></table></figure>
<p>5.编译并安装</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">make &amp;&amp; make install</span><br></pre></td></tr></table></figure>
<p>6.查找安装路径</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">whereis nginx</span><br></pre></td></tr></table></figure>
<p>7.启动，停止</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">cd &#x2F;usr&#x2F;local&#x2F;nginx&#x2F;sbin&#x2F;</span><br><span class="line">.&#x2F;nginx</span><br><span class="line">.&#x2F;nginx -s stop</span><br><span class="line">.&#x2F;nginx -s quit</span><br><span class="line">.&#x2F;nginx -s reload</span><br></pre></td></tr></table></figure>
<h2 id="导入web应用"><a href="#导入web应用" class="headerlink" title="导入web应用"></a>导入web应用</h2><p>略</p>
<h2 id="安装uwsgi"><a href="#安装uwsgi" class="headerlink" title="安装uwsgi"></a>安装uwsgi</h2><p>uWSGI是一个Web服务器，Nginx中HttpUwsgiModule的作用是与uWSGI服务器进行交换</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip install uwsgi</span><br></pre></td></tr></table></figure>
<p>wsgi<br>全称Python Web Server Gateway Interface，指定了web服务器和Python web应用或web框架之间的标准接口，以提高web应用在一系列web服务器间的移植性。<br>1.WSGI是一套接口标准协议/规范；<br>2.通信（作用）区间是Web服务器和Python Web应用程序之间；<br>3.目的是制定标准，以保证不同Web服务器可以和不同的Python程序之间相互通信</p>
<h2 id="Gunicorn"><a href="#Gunicorn" class="headerlink" title="Gunicorn"></a>Gunicorn</h2><p>高并发下的选择。这是一个被广泛使用的高性能的Python WSGI UNIX HTTP服务器,也有人选择uWsgi可以达到同样的效果。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip install gunicorn</span><br></pre></td></tr></table></figure>
<h2 id="web应用处理请求整体流程"><a href="#web应用处理请求整体流程" class="headerlink" title="web应用处理请求整体流程"></a>web应用处理请求整体流程</h2><p>1.用户操作浏览器发送请求<br>2.请求转发到对应的web服务器（nginx）<br>3.web服务器将请求转交给web应用程序，web应用程序处理请求<br>4.web应用将请求结果返回给web服务器，由web服务器返回用户响应结果<br>5.浏览器收到响应，向用户展示</p>
<h2 id="静态网页和动态网页区别"><a href="#静态网页和动态网页区别" class="headerlink" title="静态网页和动态网页区别"></a>静态网页和动态网页区别</h2><p>静态网页是写死的，所有的内容都是不变的，除非修改静态网页代码；<br>动态网页是通过数据库动态的生成网页的。</p>
<h2 id="Tomcat"><a href="#Tomcat" class="headerlink" title="Tomcat"></a>Tomcat</h2><p>Tomcat，web应用服务器（可以看作一个WEB容器，但实际上是一个应用程序服务器）（区别于Nginx的web服务器）既能为动态网页服务，又能为静态网页提供支持。单Tomcat没有通常的Web服务器快，所以大型网站可以选择Tomcat和Nginx结合，Nginx负责接受客户端的http请求，然后将请求抓发给Tomcat来处理。</p>
<h2 id="安装supervisor"><a href="#安装supervisor" class="headerlink" title="安装supervisor"></a>安装supervisor</h2><p>1.下载</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum install supervisor</span><br></pre></td></tr></table></figure>
<p>2.修改配置文件(/etc/supervisord.conf)</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[inet_http_server]         ; inet (TCP) server disabled by default</span><br><span class="line">port&#x3D;0.0.0.0:9001        ; (ip_address:port specifier, *:port for all iface)</span><br><span class="line">username&#x3D;user              ; (default is no username (open server))</span><br><span class="line">password&#x3D;123               ; (default is no password (open server))</span><br><span class="line">...</span><br><span class="line">[include]</span><br><span class="line">files &#x3D; &#x2F;etc&#x2F;supervisord.d&#x2F;*.conf</span><br></pre></td></tr></table></figure>
<p>3.各服务配置</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"># directory &#x3D; &#x2F;Code&#x2F;project        程序的启动目录  </span><br><span class="line"># command &#x3D; gunicorn -w 4 -worker-class gevent -bind 0.0.0.0:5000 入口文件名:app   启动命令</span><br><span class="line">[program:CR_data_server]</span><br><span class="line">command&#x3D;uwsgi --ini &#x2F;code&#x2F;ClashRoyale&#x2F;conf&#x2F;uwsgi.ini</span><br><span class="line">autostart&#x3D;true</span><br><span class="line">autorestart&#x3D;true</span><br><span class="line">stdout_logfile&#x3D;&#x2F;code&#x2F;ClashRoyale&#x2F;log&#x2F;uwsgi_supervisor.log</span><br><span class="line">daemonize&#x3D;no</span><br><span class="line">user&#x3D;root</span><br></pre></td></tr></table></figure>
<h2 id="单一部署"><a href="#单一部署" class="headerlink" title="单一部署"></a>单一部署</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">events &#123;</span><br><span class="line">    worker_connections 1024;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">http &#123;</span><br><span class="line">    log_format  main  &#39;$remote_addr - $remote_user [$time_local] &quot;$request&quot; &#39;</span><br><span class="line">                      &#39;$status $body_bytes_sent &quot;$http_referer&quot; &#39;</span><br><span class="line">                      &#39;&quot;$http_user_agent&quot; &quot;$http_x_forwarded_for&quot;&#39;;</span><br><span class="line"></span><br><span class="line">    access_log  &#x2F;var&#x2F;log&#x2F;nginx&#x2F;access.log  main;</span><br><span class="line"></span><br><span class="line">    sendfile            on;</span><br><span class="line">    tcp_nopush          on;</span><br><span class="line">    tcp_nodelay         on;</span><br><span class="line">    keepalive_timeout   65;</span><br><span class="line">    types_hash_max_size 2048;</span><br><span class="line"></span><br><span class="line">    include             &#x2F;etc&#x2F;nginx&#x2F;mime.types;</span><br><span class="line">    default_type        application&#x2F;octet-stream;</span><br><span class="line"></span><br><span class="line">    server &#123;</span><br><span class="line">        listen       80 default_server;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	charset utf-8;</span><br><span class="line"></span><br><span class="line">	location &#x2F; &#123;</span><br><span class="line">		include uwsgi_params;</span><br><span class="line">		uwsgi_pass 127.0.0.1:8081;</span><br><span class="line">		uwsgi_param UWSGI_CHDIR &#x2F;code&#x2F;ClashRoyale;  # 项目根目录</span><br><span class="line">		uwsgi_param UWSGI_SCRIPT server:app;        # server 为app入口name</span><br><span class="line">		uwsgi_read_timeout 300;</span><br><span class="line">		uwsgi_connect_timeout 300;</span><br><span class="line">        uwsgi_send_timeout 300;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="前后端分离部署"><a href="#前后端分离部署" class="headerlink" title="前后端分离部署"></a>前后端分离部署</h2><p>nginx配置文件：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">server &#123;</span><br><span class="line">    listen 80;</span><br><span class="line">    server_name xxxx.com www.xxxx.com;</span><br><span class="line">    location &#x2F; &#123;</span><br><span class="line">      root &#x2F;root&#x2F;works_app&#x2F;dist; # 生成的静态文件的地址</span><br><span class="line">      index index.html index.htm;</span><br><span class="line">      try_files $uri $uri&#x2F; &#x2F;index.html;</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">    location &#x2F;api &#123;</span><br><span class="line">	   	  proxy_pass http:&#x2F;&#x2F;127.0.0.1:81;     # 反向代理到后端</span><br><span class="line">	      proxy_set_header Host $host;</span><br><span class="line">	    &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">server &#123;</span><br><span class="line">    listen 81;</span><br><span class="line">    server_name xxxx.com;  # 域名，更换成自己的域名</span><br><span class="line">    location &#x2F; &#123;</span><br><span class="line">      include uwsgi_params;</span><br><span class="line">      uwsgi_pass 127.0.0.1:8081;</span><br><span class="line">      uwsgi_param UWSGI_CHDIR &#x2F;code&#x2F;DataPortal;</span><br><span class="line">      uwsgi_param UWSGI_SCRIPT manage:app;</span><br><span class="line">      uwsgi_param UWSGI_SCRIPT manage:app;</span><br><span class="line">      uwsgi_read_timeout 300;</span><br><span class="line">      uwsgi_connect_timeout 300;</span><br><span class="line">      uwsgi_send_timeout 300;</span><br><span class="line">    	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>然后重启</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nginx -s reload</span><br></pre></td></tr></table></figure>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2020/07/30/flask-nginx-uwgi-supervisor%E9%83%A8%E7%BD%B2/" data-id="ckddufv2x00012suj0uwkb9yk" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E9%83%A8%E7%BD%B2/" rel="tag">部署</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-mysql创建用户并赋予权限" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2020/07/28/mysql%E5%88%9B%E5%BB%BA%E7%94%A8%E6%88%B7%E5%B9%B6%E8%B5%8B%E4%BA%88%E6%9D%83%E9%99%90/" class="article-date">
  <time datetime="2020-07-28T06:36:31.000Z" itemprop="datePublished">2020-07-28</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2020/07/28/mysql%E5%88%9B%E5%BB%BA%E7%94%A8%E6%88%B7%E5%B9%B6%E8%B5%8B%E4%BA%88%E6%9D%83%E9%99%90/">mysql创建用户并赋予权限</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="先删除用户"><a href="#先删除用户" class="headerlink" title="先删除用户"></a>先删除用户</h2><p>因为可能上次没有彻底删除该用户，所以创建该用户时候报错</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">use mysql;</span><br><span class="line">drop user &#39;zhang&#39;@&#39;%&#39;;</span><br><span class="line">flush privileges;</span><br></pre></td></tr></table></figure>
<h2 id="创建用户"><a href="#创建用户" class="headerlink" title="创建用户"></a>创建用户</h2><p>‘zhang’是用户名， ‘%’是允许访问的IP为全部， ‘Zhang.@123’是密码</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">create user &#39;zhang&#39;@&#39;%&#39; identified by &#39;Zhang.@123&#39;;</span><br><span class="line">flush privileges;</span><br></pre></td></tr></table></figure>
<h2 id="赋予权限"><a href="#赋予权限" class="headerlink" title="赋予权限"></a>赋予权限</h2><p>mysql里好像不能进行同数据库下的多表操作</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">GRANT SELECT ON KTSredis.a_status,KTSredis.a_userinfo TO &#39;zhang&#39;@&#39;%&#39; IDENTIFIED BY &#39;Zhang.@123&#39;;</span><br></pre></td></tr></table></figure>
<p>上述做法是错误的。得多次执行（下面分别是查询，插入，修改，删除，所有,最高等权限）</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">GRANT SELECT ON KTSredis.a_userinfo TO &#39;zhang&#39;@&#39;%&#39; IDENTIFIED BY &#39;Zhang.@123&#39;;</span><br><span class="line">GRANT insert ON KTSredis.a_userinfo TO &#39;zhang&#39;@&#39;%&#39; IDENTIFIED BY &#39;Zhang.@123&#39;;</span><br><span class="line">GRANT update ON KTSredis.a_userinfo TO &#39;zhang&#39;@&#39;%&#39; IDENTIFIED BY &#39;Zhang.@123&#39;;</span><br><span class="line">GRANT delete ON KTSredis.a_userinfo TO &#39;zhang&#39;@&#39;%&#39; IDENTIFIED BY &#39;Zhang.@123&#39;;</span><br><span class="line">grant all privileges ON KTSredis.a_userinfo TO &#39;zhang&#39;@&#39;%&#39; IDENTIFIED BY &#39;Zhang.@123&#39;;</span><br><span class="line">grant all on *.* to &#39;zhang&#39;@&#39;%&#39;;</span><br></pre></td></tr></table></figure>
<p>最后刷新权限即可。</p>
<h2 id="查看权限"><a href="#查看权限" class="headerlink" title="查看权限"></a>查看权限</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">show grants;</span><br><span class="line">show grants for &#39;zhang&#39;@&#39;%&#39;;</span><br></pre></td></tr></table></figure>
<h2 id="撤销权限"><a href="#撤销权限" class="headerlink" title="撤销权限"></a>撤销权限</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">revoke all on *.* from &#39;zhang&#39;@&#39;%&#39;;</span><br><span class="line">flush privileges;</span><br></pre></td></tr></table></figure>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2020/07/28/mysql%E5%88%9B%E5%BB%BA%E7%94%A8%E6%88%B7%E5%B9%B6%E8%B5%8B%E4%BA%88%E6%9D%83%E9%99%90/" data-id="ckddufv2z00032suj2zy96p4j" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/mysql/" rel="tag">mysql</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-nginx部署问题" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2020/07/24/nginx%E9%83%A8%E7%BD%B2%E9%97%AE%E9%A2%98/" class="article-date">
  <time datetime="2020-07-24T07:50:48.000Z" itemprop="datePublished">2020-07-24</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2020/07/24/nginx%E9%83%A8%E7%BD%B2%E9%97%AE%E9%A2%98/">nginx部署问题</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="nginx出现问题时的分析"><a href="#nginx出现问题时的分析" class="headerlink" title="nginx出现问题时的分析"></a>nginx出现问题时的分析</h2><ol>
<li>nginx -s quit / nginx -t检查nginx部署状态</li>
<li>/var/log/nginx/error.log 分析问题</li>
<li>今天部署时遇到了大小写问题，大写写成了小写。找了好久，在这里记录一下。<h2 id="在nginx服务器上安装证书"><a href="#在nginx服务器上安装证书" class="headerlink" title="在nginx服务器上安装证书"></a>在nginx服务器上安装证书</h2></li>
<li>先找到nginx的目录<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cd &#x2F;etc&#x2F;nginx</span><br></pre></td></tr></table></figure></li>
<li>然后在其目录下创建cert文件夹<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mkdir cert</span><br></pre></td></tr></table></figure></li>
<li>将下载的证书文件放到cert目录下</li>
<li>找到nginx配置文件，并修改<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"># 我的是在 &#x2F;code&#x2F;DataPortal&#x2F;conf&#x2F; 下</span><br><span class="line">http &#123;</span><br><span class="line">  server &#123;</span><br><span class="line">          listen       80 default_server;</span><br><span class="line">      		server_name  www.q.cmpython.com; # 你所绑定的域名</span><br><span class="line">      		rewrite ^(.*)$ https:&#x2F;&#x2F;$host$1 permanent; # 自动跳转https</span><br><span class="line">  ...</span><br><span class="line">  &#125;</span><br><span class="line">  # HTTPS server</span><br><span class="line">  		server &#123;</span><br><span class="line">  			listen 443 ssl;</span><br><span class="line">  			server_name localhost;</span><br><span class="line">  			root html;</span><br><span class="line">  			index index.html index.htm;</span><br><span class="line">  			ssl_certificate cert&#x2F;a.pem;  # 你的证书文件</span><br><span class="line">  			ssl_certificate_key cert&#x2F;b.key;   # 你的证书文件</span><br><span class="line">  			ssl_session_timeout 5m;</span><br><span class="line">  			ssl_ciphers ECDHE-RSA-AES128-GCM-SHA256:ECDHE:ECDH:AES:HIGH:!NULL:!aNULL:!MD5:!ADH:!RC4;  #使用此加密套件。</span><br><span class="line">  			ssl_protocols TLSv1 TLSv1.1 TLSv1.2;   #使用该协议进行配置。</span><br><span class="line">  			ssl_prefer_server_ciphers on;   </span><br><span class="line">  			location &#x2F; &#123;</span><br><span class="line">  				include uwsgi_params;</span><br><span class="line">  				uwsgi_pass 127.0.0.1:8081;</span><br><span class="line">  				uwsgi_param UWSGI_CHDIR &#x2F;code&#x2F;DataPortal;</span><br><span class="line">  				uwsgi_param UWSGI_SCRIPT manage:app;</span><br><span class="line">  				uwsgi_read_timeout 300;</span><br><span class="line">  				uwsgi_connect_timeout 300;</span><br><span class="line">  				uwsgi_send_timeout 300;</span><br><span class="line">  		&#125;</span><br><span class="line">  	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li>保存nginx.conf文件并退出</li>
<li>重启Nginx服务器<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">nginx -s stop</span><br><span class="line">nginx -s start</span><br></pre></td></tr></table></figure>
</li>
</ol>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2020/07/24/nginx%E9%83%A8%E7%BD%B2%E9%97%AE%E9%A2%98/" data-id="ckddufv3900072suj6g9xhhdb" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/nginx/" rel="tag">nginx</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="mysql-sql-mode-only-full-group-by" class="article article-type-mysql" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2020/07/15/sql-mode-only-full-group-by/" class="article-date">
  <time datetime="2020-07-15T09:49:35.000Z" itemprop="datePublished">2020-07-15</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2020/07/15/sql-mode-only-full-group-by/">sql_mode=only_full_group_by</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="mysql-gruop-by报错this-is-incompatible-with-sql-mode-only-full-group-by"><a href="#mysql-gruop-by报错this-is-incompatible-with-sql-mode-only-full-group-by" class="headerlink" title="mysql gruop by报错this is incompatible with sql_mode=only_full_group_by"></a>mysql gruop by报错this is incompatible with sql_mode=only_full_group_by</h1><p>mysql复杂查询时报出：sql_mode=only_full_group_by</p>
<h2 id="查看sql-model参数"><a href="#查看sql-model参数" class="headerlink" title="查看sql_model参数"></a>查看sql_model参数</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">SELECT @@sql_mode;</span><br><span class="line">SELECT @@GLOBAL.sql_mode;</span><br><span class="line">发现：</span><br><span class="line">ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION</span><br><span class="line">第一项默认开启ONLY_FULL_GROUP_BY，</span><br></pre></td></tr></table></figure>
<h2 id="解决"><a href="#解决" class="headerlink" title="解决"></a>解决</h2><p>默认关掉ONLY_FULL_GROUP_BY</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">set @@GLOBAL.sql_mode&#x3D;&#39;&#39;;</span><br><span class="line">set sql_mode &#x3D;&#39;STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION&#39;;</span><br></pre></td></tr></table></figure>
<p>以上做法每重启一下就得重新设置一下。想要彻底解决就得修改配置文件，<br>win: my.ini, centos: /etc/my.cnf ，在[mysqld]下添加</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sql_mode &#x3D;&#39;STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION&#39;</span><br></pre></td></tr></table></figure>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2020/07/15/sql-mode-only-full-group-by/" data-id="ckddufv2h00002sujcnhjhh4q" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/mysql/" rel="tag">mysql</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-python应用中使用mongoDB" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2020/07/07/python%E5%BA%94%E7%94%A8%E4%B8%AD%E4%BD%BF%E7%94%A8mongoDB/" class="article-date">
  <time datetime="2020-07-07T09:18:07.000Z" itemprop="datePublished">2020-07-07</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2020/07/07/python%E5%BA%94%E7%94%A8%E4%B8%AD%E4%BD%BF%E7%94%A8mongoDB/">python应用中使用mongoDB</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="MongoDB简介"><a href="#MongoDB简介" class="headerlink" title="MongoDB简介"></a>MongoDB简介</h2><p>MongoDB是一种面向文档的数据库管理系统，它是由C++编写的非关系性数据库，其内容存储形式类似JSON对象</p>
<h2 id="centos安装"><a href="#centos安装" class="headerlink" title="centos安装"></a>centos安装</h2><p>先添加MongoDB源<br><a href="https://repo.mongodb.org/yum/redhat/7/mongodb-org/4.2/x86_64/RPMS/mongodb-org-server-4.2.8-1.el7.x86_64.rpm" target="_blank" rel="noopener">https://repo.mongodb.org/yum/redhat/7/mongodb-org/4.2/x86_64/RPMS/mongodb-org-server-4.2.8-1.el7.x86_64.rpm</a></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">sudo vim &#x2F;etc&#x2F;yum.repos.d&#x2F;mongodb-org.repo</span><br><span class="line">接着修改并保存</span><br><span class="line">[mongodb-org-4.2]</span><br><span class="line">name&#x3D;MongoDB Repository</span><br><span class="line">baseurl&#x3D;https:&#x2F;&#x2F;repo.mongodb.org&#x2F;yum&#x2F;redhat&#x2F;#releasever&#x2F;mongodb-org&#x2F;4.2&#x2F;x86_64&#x2F;</span><br><span class="line">gpgcheck&#x3D;1</span><br><span class="line">enabled&#x3D;1</span><br><span class="line">gpgkey&#x3D;https:&#x2F;&#x2F;www.mongodb.org&#x2F;static&#x2F;pgp&#x2F;server-4.2.asc</span><br><span class="line">然后yum安装</span><br><span class="line">sudo yum install mongodb-org</span><br><span class="line">验证</span><br><span class="line">rpm -qa |grep mongodb</span><br><span class="line">rpm -ql mongodb-org-server</span><br><span class="line">启动</span><br><span class="line">sudo systemctl start mongodb</span><br><span class="line">验证</span><br><span class="line">mongo</span><br><span class="line">停止</span><br><span class="line">sudo systemctl stop mongodb</span><br><span class="line">重启</span><br><span class="line">sudo systemvtl restart mongodb</span><br></pre></td></tr></table></figure>
<h2 id="远程连接"><a href="#远程连接" class="headerlink" title="远程连接"></a>远程连接</h2><p>修改配置绑定并重启</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">vim &#x2F;etc&#x2F;mongod.conf</span><br><span class="line">net:</span><br><span class="line">  port: 27017</span><br><span class="line">  bindIp: 0.0.0.0</span><br></pre></td></tr></table></figure>
<p>添加权限认证(配置文件中)</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">security:</span><br><span class="line">  authorization: enabled</span><br></pre></td></tr></table></figure>
<p>创建账号和密码</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">运行</span><br><span class="line">mongod --port 27017 --dbpath &#x2F;data&#x2F;db</span><br><span class="line">进入MongoDB命令行：</span><br><span class="line">mongo --port 27017</span><br><span class="line">use admin</span><br><span class="line">db.createUser(&#123;user:&#39;admin&#39;,pwd:&#39;123456&#39;,roles:[&#123;role: &#39;root&#39;, db:&#39;admin&#39;&#125;]&#125;)</span><br></pre></td></tr></table></figure>
<p>开放端口</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">systemctl status firewalld  # 查看防火墙状态</span><br><span class="line">firewall-cmd --zone&#x3D;public --add-port&#x3D;27017&#x2F;tcp --permanent # mongodb默认端口号</span><br><span class="line">firewall-cmd --reload  # 重新加载防火墙</span><br><span class="line"></span><br><span class="line">firewall-cmd --zone&#x3D;public --query-port&#x3D;27017&#x2F;tcp # 查看端口号是否开放成功，输出yes开放成功，no则失败</span><br><span class="line"></span><br><span class="line">or</span><br><span class="line"></span><br><span class="line">iptables -A INPUT -p tcp -m state --state NEW -m tcp --dport 27017 -j ACCEPT</span><br></pre></td></tr></table></figure>
<h2 id="简单使用"><a href="#简单使用" class="headerlink" title="简单使用"></a>简单使用</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br></pre></td><td class="code"><pre><span class="line"># encoding: utf-8</span><br><span class="line">&#39;&#39;&#39;</span><br><span class="line">@author: cm</span><br><span class="line">@software: vspn</span><br><span class="line">@file: update.py</span><br><span class="line">@time: 2020&#x2F;6&#x2F;15 14:57</span><br><span class="line">@desc:</span><br><span class="line">&#39;&#39;&#39;</span><br><span class="line"></span><br><span class="line">import pymongo</span><br><span class="line"># 连接MongoDB</span><br><span class="line">client &#x3D; pymongo.MongoClient(host&#x3D;&#39;localhost&#39;, port&#x3D;27017)</span><br><span class="line"># client &#x3D; pymongo.MongoClient(&#39;mongodb:&#x2F;&#x2F;localhost:27017&#x2F;&#39;)</span><br><span class="line"># 指定数据库</span><br><span class="line">db &#x3D; client.test</span><br><span class="line"># db &#x3D; client[&#39;test&#39;]</span><br><span class="line"># 指定集合</span><br><span class="line">collection &#x3D; db.student</span><br><span class="line"># collection &#x3D; db[&#39;student&#39;]</span><br><span class="line"># 插入数据</span><br><span class="line">student &#x3D; &#123;</span><br><span class="line">    &#39;id&#39;: &#39;1&#39;,</span><br><span class="line">    &#39;name&#39;: &#39;a&#39;,</span><br><span class="line">    &#39;age&#39;: 18,</span><br><span class="line">    &#39;gender&#39;: &#39;male&#39;,</span><br><span class="line">&#125;</span><br><span class="line">student1 &#x3D; &#123;</span><br><span class="line">    &#39;id&#39;: &#39;2&#39;,</span><br><span class="line">    &#39;name&#39;: &#39;b&#39;,</span><br><span class="line">    &#39;age&#39;: 18,</span><br><span class="line">    &#39;gender&#39;: &#39;male&#39;,</span><br><span class="line">&#125;</span><br><span class="line">student2 &#x3D; &#123;</span><br><span class="line">    &#39;id&#39;: &#39;3&#39;,</span><br><span class="line">    &#39;name&#39;: &#39;c&#39;,</span><br><span class="line">    &#39;age&#39;: 18,</span><br><span class="line">    &#39;gender&#39;: &#39;male&#39;,</span><br><span class="line">&#125;</span><br><span class="line">result &#x3D; collection.insert_one(student)</span><br><span class="line">result &#x3D; collection.insert_many([student1, student2])</span><br><span class="line">print(result)</span><br><span class="line"># 查询</span><br><span class="line">result &#x3D; collection.find_one(&#123;&#39;name&#39;: &#39;a&#39;&#125;)</span><br><span class="line">print(type(result))</span><br><span class="line">print(result)</span><br><span class="line"># 根据ObjectId查询</span><br><span class="line">from bson.objectid import ObjectId</span><br><span class="line">result &#x3D; collection.find_one(&#123;&#39;_id&#39;: ObjectId(&#39;593278&#39;)&#125;)</span><br><span class="line">result &#x3D; collection.find(&#123;&#39;age&#39;: 18&#125;)</span><br><span class="line">print(result)</span><br><span class="line">for item in result:</span><br><span class="line">    print(item)</span><br><span class="line">&quot;&quot;&quot;</span><br><span class="line">$lt 小于    $gt 大于  $lte 小于等于   $gte 大于等于   $ne 不等于    $in 在范围内     $nin 不在范围内      $regex 正则匹配</span><br><span class="line">$exists 属性是否存在    $type 类型判断      $mod 数字模操作      $text 文本查询      $where 高级条件查询</span><br><span class="line">&quot;&quot;&quot;</span><br><span class="line">result &#x3D; collection.find(&#123;&#39;age&#39;: &#123;&#39;$gt&#39;: 17&#125;&#125;)  # 查询大于17的数据</span><br><span class="line">result &#x3D; collection.find(&#123;&#39;age&#39;: &#123;&#39;$lt&#39;: 17&#125;&#125;)  # 查询小于17的数据</span><br><span class="line">result &#x3D; collection.find(&#123;&#39;age&#39;: &#123;&#39;$lte&#39;: 17&#125;&#125;)  # 查询小于等于17的数据</span><br><span class="line">result &#x3D; collection.find(&#123;&#39;age&#39;: &#123;&#39;$gte&#39;: 17&#125;&#125;)  # 查询大于等于17的数据</span><br><span class="line">result &#x3D; collection.find(&#123;&#39;age&#39;: &#123;&#39;$ne&#39;: 17&#125;&#125;)  # 查询不等于17的数据</span><br><span class="line">result &#x3D; collection.find(&#123;&#39;age&#39;: &#123;&#39;$in&#39;: [17, 18]&#125;&#125;)  # 查询在17-18范围内的数据</span><br><span class="line">result &#x3D; collection.find(&#123;&#39;age&#39;: &#123;&#39;$nin&#39;: [17, 18]&#125;&#125;)  # 查询不在17-18范围内的数据</span><br><span class="line">result &#x3D; collection.find(&#123;&#39;name&#39;: &#123;&#39;$regex&#39;: &#39;^A.*&#39;&#125;&#125;)</span><br><span class="line">result &#x3D; collection.find(&#123;&#39;name&#39;: &#123;&#39;$exists&#39;: True&#125;&#125;)</span><br><span class="line">result &#x3D; collection.find(&#123;&#39;name&#39;: &#123;&#39;$type&#39;: &#39;int&#39;&#125;&#125;)</span><br><span class="line">result &#x3D; collection.find(&#123;&#39;age&#39;: &#123;&#39;$mod&#39;: [5, 0]&#125;&#125;)</span><br><span class="line">result &#x3D; collection.find(&#123;&#39;$text&#39;: &#123;&#39;search&#39;: &#39;Mike&#39;&#125;&#125;)</span><br><span class="line">result &#x3D; collection.find(&#123;&#39;$where&#39;: &#39;obj.fans_count &#x3D;&#x3D; obj.follows_count&#39;&#125;)     # 粉丝数等于关注数</span><br><span class="line"># 计数</span><br><span class="line">count &#x3D; collection.find(&#123;&#39;age&#39;: 18&#125;).count</span><br><span class="line"># 排序</span><br><span class="line">results &#x3D; collection.find().sort(&#39;age&#39;, pymongo.ASCENDING)</span><br><span class="line"># 偏移</span><br><span class="line">results &#x3D; collection.find().sort(&#39;name&#39;, pymongo.ASCENDING).skip(2)</span><br><span class="line">results &#x3D; collection.find().sort(&#39;name&#39;, pymongo.ASCENDING).skip(2).limit(2)</span><br><span class="line"># 更新</span><br><span class="line">condition &#x3D; &#123;&#39;name&#39;: &#39;b&#39;&#125;</span><br><span class="line">student_result &#x3D; collection.find_one(&#123;&#39;name&#39;: &#39;b&#39;&#125;)</span><br><span class="line">student_result[&#39;age&#39;] &#x3D; 15</span><br><span class="line">result &#x3D; collection.update_one(condition, &#123;&#39;$set&#39;: student_result&#125;)</span><br><span class="line">print(result)</span><br><span class="line">print(result.matched_count, result.modified_count)  # 匹配条数， 受影响条数</span><br><span class="line">condition &#x3D; &#123;&#39;age&#39;: &#123;&#39;$gt&#39;: 15&#125;&#125;    # 大于15</span><br><span class="line">result &#x3D; collection.update_many(condition, &#123;&#39;$inc&#39;: &#123;&#39;age&#39;: 1&#125;&#125;)</span><br><span class="line">print(result)</span><br><span class="line">print(result.matched_count, result.modified_count)  # 匹配条数， 受影响条数</span><br><span class="line"># 删除</span><br><span class="line"># result &#x3D; collection.remove(&#123;&#39;name&#39;: &#39;a&#39;&#125;)</span><br><span class="line"># print(result)</span><br><span class="line">result &#x3D; collection.delete_one(&#123;&#39;name&#39;: &#39;a&#39;&#125;)</span><br><span class="line">print(result)</span><br><span class="line">results &#x3D; collection.delete_many(&#123;&#39;age&#39;: &#123;&#39;$lt&#39;: 1&#125;&#125;)</span><br><span class="line">print(result.deleted_count)</span><br><span class="line"># 组合</span><br><span class="line">result &#x3D; collection.find_one_and_delete(&#123;&#39;name&#39;: &#39;a&#39;&#125;)</span><br><span class="line">result &#x3D; collection.find_one_and_replace(&#123;&#39;name&#39;: &#39;a&#39;&#125;, &#123;&#39;y&#39;: &#39;d&#39;&#125;)</span><br><span class="line">result &#x3D; collection.find_one_and_update(&#123;&#39;name&#39;: &#39;a&#39;&#125;, &#123;&#39;name&#39;: &#39;e&#39;&#125;)</span><br><span class="line">result &#x3D; collection.create_index()</span><br><span class="line">result &#x3D; collection.create_indexs()</span><br><span class="line">result &#x3D; collection.drop_index()</span><br><span class="line"></span><br><span class="line"># 复杂查询</span><br><span class="line">result &#x3D; collection.find(&#123;&#39;$and&#39;: [&#123;&#39;sys_time&#39;: &#123;&#39;$in&#39;: [1, 10]&#125;&#125;, &#123;&#39;roomId&#39;: &#123;&#39;$in&#39;: [&#39;a&#39;, &#39;b&#39;]&#125;&#125;]&#125;)</span><br><span class="line">result &#x3D; collection.find(&#123;&#39;$or&#39;: [&#123;&#39;sys_time&#39;: &#123;&#39;$in&#39;: [1, 10]&#125;&#125;, &#123;&#39;roomId&#39;: &#123;&#39;$in&#39;: [&#39;a&#39;, &#39;b&#39;]&#125;&#125;]&#125;)</span><br></pre></td></tr></table></figure>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2020/07/07/python%E5%BA%94%E7%94%A8%E4%B8%AD%E4%BD%BF%E7%94%A8mongoDB/" data-id="ckcbuby4k00006wuj6lftea7j" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/MongoDB/" rel="tag">MongoDB</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/nosql/" rel="tag">nosql</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/python/" rel="tag">python</a></li></ul>

    </footer>
  </div>
  
</article>


  


  <nav id="page-nav">
    
    <a class="extend prev" rel="prev" href="/">&amp;laquo; Prev</a><a class="page-number" href="/">1</a><span class="page-number current">2</span><a class="page-number" href="/page/3/">3</a><a class="page-number" href="/page/4/">4</a><a class="extend next" rel="next" href="/page/3/">Next &amp;raquo;</a>
  </nav>

</section>
        
          <aside id="sidebar">
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Categories</h3>
    <div class="widget">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/%E6%90%AD%E5%BB%BA/">搭建</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tags</h3>
    <div class="widget">
      <ul class="tag-list" itemprop="keywords"><li class="tag-list-item"><a class="tag-list-link" href="/tags/MessageQueue/" rel="tag">MessageQueue</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/MongoDB/" rel="tag">MongoDB</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Python/" rel="tag">Python</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/RabbitMQ/" rel="tag">RabbitMQ</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/celery/" rel="tag">celery</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/concurrent-future/" rel="tag">concurrent.future</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/dict/" rel="tag">dict</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/django/" rel="tag">django</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/flask/" rel="tag">flask</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/git/" rel="tag">git</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/go/" rel="tag">go</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/hexo/" rel="tag">hexo</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/markdown/" rel="tag">markdown</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/mysql/" rel="tag">mysql</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/nginx/" rel="tag">nginx</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/nosql/" rel="tag">nosql</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/python/" rel="tag">python</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/redis/" rel="tag">redis</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/sqlalchemy/" rel="tag">sqlalchemy</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/v2ay/" rel="tag">v2ay</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/yapi/" rel="tag">yapi</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%B9%B6%E5%8F%91/" rel="tag">并发</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%B9%B6%E8%A1%8C/" rel="tag">并行</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E9%83%A8%E7%BD%B2/" rel="tag">部署</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget tagcloud">
      <a href="/tags/MessageQueue/" style="font-size: 10px;">MessageQueue</a> <a href="/tags/MongoDB/" style="font-size: 10px;">MongoDB</a> <a href="/tags/Python/" style="font-size: 10px;">Python</a> <a href="/tags/RabbitMQ/" style="font-size: 10px;">RabbitMQ</a> <a href="/tags/celery/" style="font-size: 12.5px;">celery</a> <a href="/tags/concurrent-future/" style="font-size: 10px;">concurrent.future</a> <a href="/tags/dict/" style="font-size: 10px;">dict</a> <a href="/tags/django/" style="font-size: 10px;">django</a> <a href="/tags/flask/" style="font-size: 17.5px;">flask</a> <a href="/tags/git/" style="font-size: 10px;">git</a> <a href="/tags/go/" style="font-size: 10px;">go</a> <a href="/tags/hexo/" style="font-size: 10px;">hexo</a> <a href="/tags/markdown/" style="font-size: 10px;">markdown</a> <a href="/tags/mysql/" style="font-size: 17.5px;">mysql</a> <a href="/tags/nginx/" style="font-size: 10px;">nginx</a> <a href="/tags/nosql/" style="font-size: 10px;">nosql</a> <a href="/tags/python/" style="font-size: 20px;">python</a> <a href="/tags/redis/" style="font-size: 12.5px;">redis</a> <a href="/tags/sqlalchemy/" style="font-size: 15px;">sqlalchemy</a> <a href="/tags/v2ay/" style="font-size: 10px;">v2ay</a> <a href="/tags/yapi/" style="font-size: 10px;">yapi</a> <a href="/tags/%E5%B9%B6%E5%8F%91/" style="font-size: 10px;">并发</a> <a href="/tags/%E5%B9%B6%E8%A1%8C/" style="font-size: 10px;">并行</a> <a href="/tags/%E9%83%A8%E7%BD%B2/" style="font-size: 10px;">部署</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/09/">September 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/08/">August 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/07/">July 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/06/">June 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/05/">May 2020</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2020/09/09/pypy%E5%AE%89%E8%A3%85/">pypy安装</a>
          </li>
        
          <li>
            <a href="/2020/09/09/%E5%87%BD%E6%95%B0%E5%BC%8F%E7%BC%96%E7%A8%8B%E5%92%8C%E9%9D%A2%E5%90%91%E5%AF%B9%E8%B1%A1%E7%BC%96%E7%A8%8B/">函数式编程和面向对象编程</a>
          </li>
        
          <li>
            <a href="/2020/09/09/sqlalchemy%E6%97%A0%E6%B3%95%E6%9F%A5%E8%AF%A2%E4%B8%8D%E4%B8%BA%E5%90%8C%E4%B8%80%E4%B8%AA%E5%AF%B9%E8%B1%A1%E4%BF%AE%E6%94%B9%E7%9A%84%E6%95%B0%E6%8D%AE/">sqlalchemy无法查询不为同一个对象修改的数据</a>
          </li>
        
          <li>
            <a href="/2020/09/02/web%E5%90%8E%E7%AB%AF%E9%9C%80%E8%A6%81%E4%BA%86%E8%A7%A3%E7%9A%84%E7%9F%A5%E8%AF%86/">web后端需要了解的知识</a>
          </li>
        
          <li>
            <a href="/2020/08/28/redis%E9%AB%98%E5%8F%AF%E7%94%A8%E9%85%8D%E7%BD%AE/">redis高可用配置</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2020 John Doe<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    

<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  
<link rel="stylesheet" href="/fancybox/jquery.fancybox.css">

  
<script src="/fancybox/jquery.fancybox.pack.js"></script>




<script src="/js/script.js"></script>




  </div>
</body>
</html>